# 项目博客

## iteration 1

### PSP表格

| PSP                                     | Personal Software Process Stages        | 预估耗时（分钟） | 实际耗时（分钟） |
| --------------------------------------- | --------------------------------------- | ---------------- | ---------------- |
| Planning                                | 计划                                    |        5          |     5             |
| ・ Estimate                              | ・ 估计这个任务需要多少时间              |           5       |  5                |
| Development                             | 开发                                    |       495           |     750             |
| ・ Analysis                              | ・ 需求分析 (包括学习新技术)             |         60    |              120    |
| ・ Design Spec                           | ・ 生成设计文档                          |         10         |       5           |
| ・ Coding Standard                       | ・ 代码规范 (为目前的开发制定合适的规范) |          5        |            5      |
| ・ Design                                | ・ 具体设计                              |    60              |      60            |
| ・ Coding                                | ・ 具体编码                              |    300              |      500            |
| ・ Code Review                           | ・ 代码复审                              |  20                |       20           |
| ・ Test                                  | ・ 测试（自我测试，修改代码，提交修改）  |        40          |            40      |
| Reporting                               | 报告                                    |             80     |      50            |
| ・ Test Report                           | ・ 测试报告                              |       60           |     40             |
| ・ Size Measurement                      | ・ 计算工作量                            |       10           |    5              |
| ・ Postmortem & Process Improvement Plan | ・ 事后总结, 并提出过程改进计划          |          10        |      5            |
|                                         | 合计                                    |           580       |       805           |

#### 超时原因分析

Qt虽然之前做过，但是忘了不少，另外之前也没有使用过Qt的网络库，用起来不是很熟练.

多线程开发最重要的一点就是资源共享，对于平时很少接触多线程编程的笔者，难度实在不小，这种难度遇到C++难以阅读的运行时错误报告时，基本需要花费很久才能找到问题所在.

程序的Debug环节最终要比编码环节占时长，根本原因就是异常出现的位置，Qt框架难以给出（给出的错误都出现在Qt库函数文件中）

### 思路

#### 资料来源

Google + Qt文档 + ChatGPT

#### 多线程下载

解析命令行参数 -> 获取下载文件的字节数 -> 平均分配给每个线程 -> 单独下载 -> 合并

#### 显示进度

使用Qt提供的QProgressBar + QNetworkReply的downloadProgress signal

### 实现过程

MainWindow类 -> 显示程序主窗口

DownloadThread类 -> 继承自QThread，单个线程用于下载文件

DownloadCard类 -> 继承自QWidget，用于显示总下载进度

DownloadDetailCard类 -> 继承自QWidget，用于显示每个线程的下载详情

单元测试使用qDebug跟踪调试信息

### 性能分析

程序的性能瓶颈主要在单个线程的文件下载上:

如果文件很大，未从缓存写入到文件中的字节都放在内存中，导致程序所占内存极大（几百MB）.

改进思路：

设置一个阈值，单个线程读取的字节数如果超过这个阈值，就将读取到的字节写入文件，然后接上次继续向服务器请求.

当然，没有银弹，这种做法会带来频繁的IO开销，提升了空间性能，却降低了时间性能.
